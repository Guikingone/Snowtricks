parameters:
#    parameter_name: value

services:
    # Command manager
    app.manager:
        class: AppBundle\Services\FileManager
        arguments:
           - '%kernel.root_dir%'
           - '@doctrine.orm.entity_manager'
        tags:
            - { name: kernel.event_listener, event: file.updated, method: checkCache }

    # Main service
    app.back:
        class: AppBundle\Services\Back
        arguments:
            - '@doctrine.orm.entity_manager'
            - '@form.factory'
            - '@session'
            - '@event_dispatcher'
            - '@workflow.tricks_process'

    # Tricks listeners.
    app.trick_listener:
        class: AppBundle\Listeners\TricksListeners
        arguments:
            - '@workflow.tricks_process'
            - '@security.authorization_checker'
            - '@templating'
            - '@session'
            - '@security.token_storage'
            - '@request_stack'
        tags:
            - { name: doctrine.event_listener, event: prePersist }
            - { name: doctrine.event_listener, event: postPersist }
            - { name: kernel.event_listener, event: tricks.validated, method: onValidateTricks }
            - { name: kernel.event_listener, event: tricks.refused, method: onRefusetricks }

    # Tricks command
    app.command.tricks:
        class: AppBundle\Command\LoadTricksCommand
        tags:
           - { name: console.command }

    # User service
    user.security:
        class: UserBundle\Services\Security
        arguments:
           - '@doctrine.orm.entity_manager'
           - '@form.factory'
           - '@security.authorization_checker'
           - '@security.authentication_utils'
           - '@security.password_encoder'
           - '@security.token_storage'
           - '@event_dispatcher'
           - '@request_stack'
           - '@workflow.user_process'

    # user form listeners.
    app.user_listener:
        class: UserBundle\Listeners\RegisterListeners
        arguments:
            - '@security.password_encoder'
            - '@session'
            - '@templating'
        tags:
            - { name: doctrine.event_listener, event: prePersist }
            - { name: doctrine.event_listener, event: postPersist }
            - { name: kernel.event_listener, event: user.validated, method: onValidatedUser }

